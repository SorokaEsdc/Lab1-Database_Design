DROP TABLE IF EXISTS Cooking CASCADE;
DROP TABLE IF EXISTS Payment CASCADE;
DROP TABLE IF EXISTS "Order" CASCADE;
DROP TABLE IF EXISTS Dish CASCADE;
DROP TABLE IF EXISTS ingredients CASCADE;
DROP TABLE IF EXISTS Reservation CASCADE;
DROP TABLE IF EXISTS Restaurant_Table CASCADE;
DROP TABLE IF EXISTS Employee_Role CASCADE;
DROP TABLE IF EXISTS Employee CASCADE;
DROP TABLE IF EXISTS Agent CASCADE;
DROP TABLE IF EXISTS Customer CASCADE;

CREATE TABLE Customer (
    customer_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL
);

CREATE TABLE Agent (
    agent_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL
);


CREATE TABLE Employee (
    employee_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    employee_role_id UUID,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    work_day DATE NOT NULL
);

CREATE TABLE Employee_Role (
    employee_role_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    role_name VARCHAR(100) NOT NULL,
    salary INT CHECK (salary >= 0)
);

CREATE TABLE ingredients (
    ingredients_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    expiration_date DATE NOT NULL
);

CREATE TABLE Dish (
    dish_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ingredients_id UUID NOT NULL,
    name VARCHAR(200) NOT NULL,
    price NUMERIC(10,2) NOT NULL CHECK (price >= 0),
    weight NUMERIC(10,2) NOT NULL CHECK (weight >= 0),
    calories NUMERIC(10,2) CHECK (calories >= 0)
);

CREATE TABLE Restaurant_Table (
    table_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    table_number VARCHAR(20) UNIQUE NOT NULL,
    capacity INT NOT NULL CHECK (capacity > 0)
);

CREATE TABLE Reservation (
    reservation_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    customer_id UUID NOT NULL,
    agent_id UUID,
    table_id UUID NOT NULL,
    name VARCHAR(100),
    reservation_start TIMESTAMP NOT NULL,
    reservation_end TIMESTAMP NOT NULL,
    work_day DATE NOT NULL
);

CREATE TABLE "Order" (
    order_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    reservation_id UUID NOT NULL,
    employee_id UUID,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    quantity INT NOT NULL CHECK (quantity > 0)
);

CREATE TABLE Payment (
    payment_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL,
    paid_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    amount NUMERIC(12,2) NOT NULL CHECK (amount >= 0)
);

CREATE TABLE Cooking (
    cooking_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    dish_id UUID NOT NULL,
    employee_id UUID NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE Reservation
    ADD CONSTRAINT fk_reservation_customer
    FOREIGN KEY (customer_id) REFERENCES Customer(customer_id);

ALTER TABLE Reservation
    ADD CONSTRAINT fk_reservation_agent
    FOREIGN KEY (agent_id) REFERENCES Agent(agent_id);

ALTER TABLE Reservation
    ADD CONSTRAINT fk_reservation_table
    FOREIGN KEY (table_id) REFERENCES Restaurant_Table(table_id);

ALTER TABLE Employee
    ADD CONSTRAINT fk_employee_role
    FOREIGN KEY (employee_role_id) REFERENCES Employee_Role(employee_role_id);

ALTER TABLE Dish
    ADD CONSTRAINT fk_dish_ingredients
    FOREIGN KEY (ingredients_id) REFERENCES ingredients(ingredients_id);

ALTER TABLE "Order"
    ADD CONSTRAINT fk_order_reservation
    FOREIGN KEY (reservation_id) REFERENCES Reservation(reservation_id);

ALTER TABLE "Order"
    ADD CONSTRAINT fk_order_employee
    FOREIGN KEY (employee_id) REFERENCES Employee(employee_id);

ALTER TABLE Cooking
    ADD CONSTRAINT fk_cooking_dish
    FOREIGN KEY (dish_id) REFERENCES Dish(dish_id);

ALTER TABLE Cooking
    ADD CONSTRAINT fk_cooking_employee
    FOREIGN KEY (employee_id) REFERENCES Employee(employee_id);

ALTER TABLE Payment
    ADD CONSTRAINT fk_payment_order
    FOREIGN KEY (order_id) REFERENCES "Order"(order_id);


